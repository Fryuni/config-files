<script type="text/javascript">
  RED.nodes.registerType("notify", {
    category: "effect",
    color: "#5b85a7",
    defaults: {
      name: { value: "_DEFAULT_" },
      appName: {
        value: "Node RED",
        validate: RED.validators.typedInput({ typeField: "appNameType" }),
      },
      appNameType: { value: "str" },
      message: {
        value: "payload",
        validate: RED.validators.typedInput({ typeField: "messageType" }),
      },
      messageType: { value: "msg" },
    },

    outputs: 0,
    inputs: 1,
    align: "left",
    label() {
      return this.name || "notify";
    },
    labelStyle() {
      return this.name ? "node_label_italic" : "";
    },

    oneditprepare: function () {
      var that = this;

      $("#node-input-appName").typedInput({
        default: "str",
        types: ["flow", "global", "msg", "str", "jsonata", "env"],
        typeField: $("#node-input-appNameType"),
      });

      $("#node-input-message").typedInput({
        default: "msg",
        types: ["msg", "str", "jsonata"],
        typeField: $("#node-input-messageType"),
      });

      // if (this.appNameType === "jsonata") {
      //   var property = this.appName || "";
      //   $("#node-input-typed-appName").typedInput("type", "jsonata");
      //   $("#node-input-typed-appName").typedInput("value", property);
      // } else if (
      //   this.appNameType === "full" ||
      //   this.appName === "true" ||
      //   this.appName === true
      // ) {
      //   // show appName message object
      //   $("#node-input-typed-appName").typedInput("type", "full");
      // } else {
      //   var property =
      //     !this.appName || this.appName === "false"
      //       ? "payload"
      //       : this.appName + "";
      //   $("#node-input-typed-appName").typedInput("type", "msg");
      //   $("#node-input-typed-appName").typedInput("value", property);
      // }
      // $("#node-input-typed-appName").on("change", function () {
      //   if (
      //     $("#node-input-typed-appName").typedInput("type") === "msg" &&
      //     $("#node-input-typed-appName").typedInput("value") === ""
      //   ) {
      //     $("#node-input-typed-appName").typedInput("value", "payload");
      //   }
      // });
    },
    oneditsave: function () {},
    onadd: function () {
      if (this.name === "_DEFAULT_") {
        this.name = "";
        RED.actions.invoke("core:generate-node-names", this, {
          generateHistory: false,
        });
      }
    },
  });
</script>

<script type="text/html" data-template-name="notify">
  <div class="form-row">
    <label for="node-input-name">
      <span>Name:</span>
    </label>
    <input type="text" id="node-input-name" placeholder="notify" />
  </div>
  <div class="form-row">
    <label for="node-input-typed-appName">
      <i class="fa fa-list"></i> <span>App Name:</span>
    </label>
    <input type="text" id="node-input-appName" style="width: 70%" />
    <input type="hidden" id="node-input-appNameType" />
  </div>
  <div class="form-row">
    <label for="node-input-message">
      <i class="fa fa-list"></i> <span>Message:</span>
    </label>
    <input type="text" id="node-input-message" style="width: 70%" />
    <input type="hidden" id="node-input-messageType" />
  </div>
</script>
